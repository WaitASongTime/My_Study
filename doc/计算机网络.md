# 计算机网络

### 第一章、计算机简介

#### 1.计算机功能

+ 连通性：彼此连通，交换信息
+ 共享：信息共享，软硬件共享

#### 2.网络、互联网、因特网

+ 网络：许多计算机连接起来
+ 互联网：许多网络连接在一起
+ 因特网：全球最大的互联网

#### 3.因特网的组成

- 因特网的核心
  - 数据交换方式
    - 电路交换：打电话，适合数量巨大的实时
    - 报文交换：
    - 分组交换：计算机网络的交换方式
      - 优点：高效、灵活、迅速、可靠
      - 缺点：时延、开销
- 边缘部分
  - 主机之间的通信方法
    - 客户服务器方式（Client/Sever）
    - 对等方式（P2P）：P2P下载

#### 4.计算机网络分类

- 按照作用范围
  - 广域网（WAN）：使用了广域网技术，花钱买服务，花钱买带宽
  - 局域网（LAN）：使用了局域网技术，自己买设备，自己维护，带宽固定，距离100米
- 拓扑结构
  - 总线型
  - 环形
  - 星型
  - 树型
  - 网状
- 交换方式
  - 电路交换
  - 报文交换
  - 分组交换

#### 5.计算机网络的性能

+ 速率：连接在网络的主机在数字信道上传输数据位数的速率，单位b/s、kb/s、Mb/s、Gb/s
+ 带宽：数字信道所能传送的最高速率
+ 吞吐量：单位时间内通过某个网络的数据量
+ 时延：
  + 发送时延
  + 传播时延
  + 处理时延
  + 排队时延

------



### 第二章、TCP/IP

![](F:\my_study\pictures\internet\互联网协议.png)

#### 1、对等层传输

+ PDU：对等层之间传输的数据单位
  + 资源层面
    + 应用层：APDU，Application
    + 表示层：PPDU，Presentation
    + 会话层：SPDU，Session
  + 传输层：Segment，将数据进行切片
  + 通信层面
    + 网络层：Packet，包
    + 数据链路层：Frame，帧
    + 物理层：Bit，比特
+ OSI模型缺点
  + 实现7层模型难，按照7层模型运行效率低
  + 划分有不合理之处

#### 2、TCP/IP概念层

##### 1.概念划分

+ 目的：解决异种计算机之间的网络通信问题

+ 应用层（应用层，表示层，会话层）
  + 各种服务及应用程序通过该层利用网络
  + 服务于Telnet、Ftp、Smtp等，负责处理特定应用程序细节
  + 常用协议：
    + HTTP
    + FTP：文件传输协议
    + SMTP
+ 传输层
  + 确认数据传输及进行纠错处理
  + 常用协议：
    + TCP：Transmission Control Protocol，一个可靠的面向连接的协议，保障某一主机的字节流准确无误的投递到互联网的另一台主机
    + UDP：User Dategram Protocol，无连接服务，无重发和纠错功能，不保证数据的可靠传输 
+ 网络层
  + 主要任务是路径选择，让每个分组独立到达目的地，在接收端由高层协议重排
  + 常用协议：
    + IP：Internet Protocol,互联网报文协议
    + ARP：地址解析协议，将互联网地址转换为物理地址（MAC地址）
    + RARP：反向地址解析协议，将物理地址转换为互联网地址
    + ICMP：Internet Control Message Protocol，ping命令，主要用来差错纠正和报文控制
    + IGMP
+ 网络接口层（数据链路层，物理层）
  + 通常包括网络接口卡及设备驱动
  + 针对不同物理网络的连接形式的协议
    + Ethernet
    + FDDI
    + ATM

##### 2.TCP/IP基本工作原理

![](F:\my_study\pictures\internet\tcp_ip数据封装.png)

![](F:\my_study\pictures\internet\数据对等传输.png)

##### 3.网络接口层

+ IEEE：美国电器与电子协会，1980年2月成立了局域网标准委员会，其中一份工作就是局域网的标准化工作，最初指定了IEEE—802标准，此标准主要针对局域网，主要涉及对象就是ISO模型中的数据链路层和物理层。其中将数据链路层分为两个部分：
  + LLC：逻辑链路层
  + MAC：介质访问控制层
+ LLC
  + 基于逻辑思想的控制
  + 基于LLC的四种数据操作类型
    + 不确认的无连接服务：不需要对方进行确认
    + 面向连接的服务
    + 待确认的无连接服务
    + 高速传送的服务
  + 功能
    + 连接管理
    + 与高层的接口
    + 帧的可靠，按序传输以及流量控制
+ MAC
  + 与传输介质有关，决定对传输介质访问权，可以将MAC决定对传输介质的访问分为三种方式：
    + 循环式：每个站点轮流得到发送数据的机会
    + 预约式：在传输数据时，需要预约资源
    + 竞争式：自由竞争，按照先到先得的原则发送数据，抢占网络传输资源
  + 功能
    + 帧的封装和拆封
    + 物理介质传输差错检测
    + 寻址

##### 4.网络层

网络层协议

- IP协议
- ARP：地址解析协议
- RARP：反向地址解析协议
- ICMP：互联网控制消息协议

###### A、IP协议

+ 功能：
  + 寻址和路由
  + 传递服务
    + 不可靠，可靠性由上层协议提供
    + 无连接
  + 数据报分段和重组
+ 格式

![](F:\my_study\pictures\internet\ip.jpg)

+ 版本
  + IPV4：0100
  + IPV6
+ 首部长度【20bytes---60bytes
  + 占4个字节
  + 一个单位占4个字节
  + 因此IP首部长度最大值是60个字节：1111      ----------》15*4 = 60
+ 总长度
  + 首部+数据部分，最大长度：65535
  + 总长度必须不超过最大传送单元MTU
+ 标识
+ 标志：一个计数器，用来产生数据报的标识
  + 占3bit ，最低位是MF,中间位是DF，一个目前没有被使用
  + MF=1，表示后面还有分片
  + MF=0，表示最后一个分片
  + DF=0，允许分片
+ 片偏移
+ 生存时间
  + windows初始值是64
+ 协议
  + 占8bit
  + 此数据携带的数据使用何种协议，以便目的主机的IP层将数据上交给哪个处理过程
+ 首部校验和
+ 源地址
+ 目的地址
+ 可选字段
+ 填充部分

###### B、ARP协议

1. 逻辑地址（IP地址）

   + 网络级别
     + 全局唯一性
     + 用软件实现
     + 日常用10进制表示，32位bit组成

2. 物理地址（MAC地址）

   + 物理级别，局域网内唯一表示一台设备
     + 在本地范围具有唯一性：局域范围内
     + 用硬件实现：网卡BIOS芯片
     + 日常用16进制表示，一般情况下48位
       + 前24位：厂家代码，由厂家向IEEE委员会购买
       + 后24位：序列号

3. 表示一台电脑的三种方式

   - 域名
     - 应用层
   - IP地址：
     - 网络层
   - MAC地址：
     - 网路接口层
     - 相比域名和IP地址可以通过软件随意变更，MAC地址具有固定性，更改比较困难，因此，识别准确；
     - 在局域网内，实际采用MAC地址确定一台设备
   - 为什么有了IP地址还要用MAC地址
     - IP地址一般情况下容易修改和变动，具有随意性，因此不能在网络上固定的标识一台设备
     - MAC地址一般情况下出厂时由厂家烧录到硬件中，不容易修改，因此在局域网内容易定位唯一一台设备
     - 从拓扑结构和分层分析，IP地址属于网络层，主要功能是在广域网内路由寻址，选择最佳路由；而MAC地址在网络接口层要形成适合于在网络媒体上传输的数据帧

4. 原理

   + 不管网路层使用的是什么协议，在实际网络的链路上传送数据帧是，最终还是必须使用硬件地址
   + 每一个主机都设有一个ARP高速缓存，里面有所有的局域网上的各主机和路由器的IP地址到硬件地址的映射表
   + 当主机A欲向本局域网上的某个主机B发送IP数据报时，就先在ARP高速缓存中查看有无主机B的Ip地址。如有，就可查出其对应的硬件地址，再将此硬件地址写入到MAC帧中，然后通过局域网将该MAC帧发往此硬件地址

5. 注意问题

   + ARP解决的是同一个局域网上的主机或路由器的IP地址和硬件地址的映射问题
   + 如果所要找的主机和源主机不在同一个局域网上，那么久通过ARP找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网路。剩下的工作就由下一个网络来做

6. APR分组格式

   ![](F:\my_study\pictures\internet\arp.jpg)

###### C、RARP协议

1. 概念

   逆地址解析协议，只知道自己的硬件地址的主机，使用RARP协议来获取自己的IP地址

###### D、ICMP协议

![](F:\my_study\pictures\internet\ICMP.jpg)

1. 概念

   + IP协议缺点
     + 无差错报告和差错纠正机制
     + 缺少一种为主机和管理查询的机制
   + ICMP报文首先封装成IP数据报，然后再传送到下一层；在IP数据报中的协议字段值是1，就表示IP数据是ICMP报文

2. 种类

   + 差错报告报文：ICMP总是把差错报文报告给原始的数据源
     + 类型3：终点不可达
     + 类型4：源点抑制，发送方和接收方接收能力不一致
     + 类型11：超时
     + 类型12：参数问题，IP数据报头部被修改
     + 类型5：路由重定向
   + 查询报文
     + 类型8或0：回送请求或回答
     + 类型13或14：时间戳请求或回答
     + 类型17或18：地址码请求或回答
     + 类型10或9：路由器查询通告

3. 报文结构

   ![](F:\my_study\pictures\internet\icmp_form.gif)

   + 类型
     + 差错报告报文
     + 查询报文
   + 代码
   + 检验和
   + 标识符
   + 序列号
   + 数据

4. 终点不可达

   + 类型：3
   + 代码：
     + 0：网络不可达，一般是路由器故障，不知道将数据报转发给哪个网段
     + 1：主机不可达，一般是路由器故障，知道网段，但是不知道主机
     + 2：协议不可达，由PC发送给源端主机，目的主机的协议未开启
     + 3：端口不可达，
     + 4：需要分片，但是设置了不可分片
     + 5：源站选路失败
     + 6：目的网络不认识，路由器没有目的网络的任何信息
     + 7：目的主机不认识
     + 13：由于过滤，通信被强制禁止，防火墙过滤

5. 源点抑制

   + 类型：4
   + IP协议是无连接协议，没有流量控制，容易出现拥塞问题

6. 超时

   + 类型：11

7. ping命令

8. tracert

##### 5.传输层

+ 功能
  + 分段及封装应用层送来的数据
  + 提供端到端的传输服务
  + 在发送主机和接收主机之间构建逻辑通信
  + 包括两个协议
    + TCP
    + UDP
+ 两台主机通信的条件
  + 本地主机（IP地址定义）
  + 本地进程（端口定义）
  + 远程主机（IP地址定义）
  + 远程进程（端口定义）
+ 端口范围
  + 熟知端口：0-1023，由ICANN指派和控制
    + FTP
      + 控制连接：21
      + 数据：20
    + Telnet：23
    + DNS：53
    + HTTP：80
  + 注册端口：1024-49151，
  + 动态端口：49152-65535，
+ 应用程序产生应用进程，应用进程会开启相应的应用端口，应用端口为应用程序提供相应的服务

###### TCP协议

1. 特点

   - 面向连接
     - 通讯双方交换数据之前必须建立连接
   - 可靠
     - 多种确保可靠性的机制
   - 字节流服务
     - 8bit（1Byte）为最小单位构成的字节流

2. 套接字地址

   + TCP使用"连接"作为最基本的抽象对象，同时将TCP连接的端点成为插口（socket）,或者套接字

   + 插口和端口/ip地址的关系

     ![](F:\my_study\pictures\internet\socket.png)

3. 原理

   ![](F:\my_study\pictures\internet\tcp.jpg)

   + TCP发送进程以字节流的形式传递数据，而接收进程也把数据作为字节流来接收，类似于假想的管道
   + UDP发送进程数据报文都是独立的，因此UDP不是面向流的协议
   + 缓存：数据流向的每一个方向上都有两种缓存：发送缓存和接收缓存
   + 在传输层向网络层发送数据时，要以分组为单位，而不是按字节流来发送。TCP协议把若干字节构成分组，我们把这样的分组成为报文段，即Segment。每个报文段不一定一样长

4. 字节号

   + 范围：0-2的32次方-1
   + 以字节为单位
   + 编号机制：随机
   + 举例：假如随机号是1057，而要发送6000个字节，那么字节编号范围是：
     + 1057----------7056

5. 序号

   + 报文段序号就是所传送报文段中第一个字节的字节号
   + 举例：TCP协议要传输6000个字节的文件，第一个字节的编号是10001，如果数据被分为5个报文段，前4个报文段各携带1000个字节数据，最后一个携带剩余2000字节数据，那么：
     + 第一个报文段：序号：1001------------  字节号范围（10001 ---------------- 11000）
     + 第二个报文段：序号：11001------------字节号范围（11001 ---------------- 12000）
     + 第三个报文段：序号：12001------------字节号范围（ 12001 ---------------- 13000）
     + 第四个报文段： 序号：13001------------字节号范围（13001 ---------------- 14000）
     + 第五个报文段：序号：14001------------ 字节号范围（  14001 ----------------16000 ）

6. TCP报文段格式

   ![](F:\my_study\pictures\internet\TCP_form.jpg)

   + 源端口：
     + 2个字节，占16位，一般是动态端口
   + 目的端口 
     + 2个字节，占16位
   + 序号
     + 占4个字节
   + 确认号
     + 占4个字节，是期望收到对方下一个报文段的数据的第一个字节的序号
   + 首部长度
     + 占4bit，最小值是0101，即5，最大值是1111，即15；
     + 它指出TCP首部共有多少个4字节，也就是说以4个字节为单位
       + 5 * 4 = 20 字节
       + 15 * 4 = 60 字节
     + 所以，首部长度范围：20-60字节
   + 保留位
   + URG
     + 紧急bit，urgent
       + URG = 1，需要紧急处理
   + ACK
     + acknowledge，确认
   + PSH
     + Push，接收TCP收到推送比特置为1的报文段，就尽快的交付给接收应用进程，而不再等到整个缓存都填满后再向上交付
   + RST
     + reset，复位
       + 当RST = 1，表明TCP连接中出现严重差错，必须释放连接，然后再重新建立运输连接
     + 出现情况
       + 拒绝连接请求，接收端未开启相应的服务
       + 异常终止连接，关机，死机
       + 终止空闲连接
   + SYN
     + synchronized，同步
     + 同步比特SYN置为1，就表示这是一个连接请求或连接接收报文
   + FIN
     + Finish
   + 窗口字段
     + 占2字节
     + 用来控制对方发送的数据量，单位为字节，根据缓存来确定自己的接受窗口大小
   + 检验和
     + 保证数据的正确性
   + 紧急指针
   + 选项
     + 目前只规定了MSS，Maximum Segement Size，报文段中数据字段最大长度；MTU，Maximum Transmission Unit，最大传输单元，以太网中一般是1500byte，
     + MSS = MTU - 20byte(IP首部)-20byte(TCP首部)
   + 填充
     + 为了使整个首部是4字节的整数倍

7. 三次握手

   

###### UDP协议

![](F:\my_study\pictures\internet\udp.jpg)

1. 特点：
   + 无连接
   + 不可靠
2. UDP长度
   + UDP长度 = UDP头部 + 数据
   + UDP长度 = IP长度 - IP头部长度
3. UDP责任
   + 创建进程到进程间的通信：TFTP，SNMP，DNS（53端口）
   + 有限的差错控制，出现差错悄悄丢弃报文分组

##### 应用层

1. 总览
   + 网页浏览：HTTP，SSL
   + 文件传输：FTP，TFTP
   + E-mail：SMTP，POP3
   + 远程登陆：Telnet（23端口），SSH（22端口）
   + 域名服务：DNS（使用UDP协议，53端口）
   + 网络管理：SNMP





------



### 防火墙

#### 一.防火墙体系及功能

1. 功能：
   + 内外网隔离
     + 截取IP包，根据策略控制进出
     + 双向网络地址转换
     + 基于一次性口令对移动访问进行识别和控制
     + IP MAC捆绑
   + 安全记录
     + 通信事件记录
     + 操作事件记录
     + 违规事件记录
     + 异常情况告警
2. 安全公理/定理/推理
   + 公理：所有程序都有缺陷（莫菲定理）
   + 推论：对外暴露的计算机，应尽可能少地运行程序，且运行的程序也仅可能地小
   + 推论：防火墙基本法则：防火墙必须配置得尽可能地小，才能降低风险
3. 包过滤防火墙
   1. 基本思想
      + 对于每个进来的包，使用一组规则，然后决定转发或者丢弃
   2. 如何过滤
      + 检查头中的信息，源地址，目标IP，IP协议，源和目标端口
   3. 优点
      + 实现简单
      + 对用户透明
      + 效率高
   4. 缺点
      + 正确制定规则不容易
      + 不可能引入认证机制

























