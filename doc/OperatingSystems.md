# 操作系统

### 一 、引论

1. 定义：操作系统是一组控制和管理计算机硬件和软件资源，合理对各类作业进行调度，以便用户使用的程序集合。

2. 操作系统
   + UNIX
   + Linux
   + DOS
   + Windows

3. 操作系统的目的
   + 方便性
   + 有效性
   + 可扩充性
   + 开放性

4. 作用
   + 用户与硬件系统的接口
     + 软件接口，给用户提供三种使用方式来使用计算机
       + 命令方式
       + 系统调用方式
       + 图形，窗口方式
   + 计算机四类资源的管理者
     + 处理机管理
     + 存储器管理
     + 设备管理
     + 文件管理
   + 用作扩充机器
     + 裸机：无任何软件的计算机系统
     + 虚拟机：覆盖了软件的机器

5. 操作系统的发展过程
   + 无操作系统的计算机系统：ENIAC
   + 单道批处理系统（50年代）
     + 自动性：无人工干预
     + 顺序性：按进入内存的先后执行
     + 单道性：内存中只保持一道作业
   + 多道批处理系统（60年代）
     + 内存中同时存放多个相互独立的程序
     + 多道技术是共享的基础
     + 特点：
       + 多道性：内存中右多道程序，可并发执行
       + 无序性：完成时间与进入内存先后无关，提高了系统资源的利用率
       + 调度性：作业从提交到完成经过两次调度
         + 作业调度：外存------》内存
         + 进度调度：分配处理机
   + 分时系统（60年代）
     + 定义：一台主机连接了多个终端，同时允许多个用户通过自己的终端，以交互方式使用计算机，共享主机中的资源
     + 产生动力
       + 人-机交互（边运行边调试）
       + 共享主机（设备昂贵）
       + 便于用户上机（在终端上输入/控制）
     + 特征：
       + 多路性：即同时性，在宏观上同时，微观上轮流，在同一时间范围内为多个用户服务
       + 独立性：每个用户感觉上独占主机
       + 及时性：较短时间响应（2-3秒）
       + 交互性：

   + 实时系统（60年代）
     + 实时：及时响应外部事件请求
     + 应用需求：
       + 实时控制：工业生产，武器控制，飞机自动驾驶等
       + 实时信息处理：订票系统

6. 操作系统的特特征

   + 并发性
     + 并行性：多个事件在同一时刻发生，真正的同时发生
     + 并发性：多个事件在同一时间间隔内发生
     + 单处理机系统：宏观并发，微观串行
     + 多处理机系统：可能有并行
   + 共享性
     + 互斥共享方式：对临界资源的访问
       + 临界资源：一次只允许一个进程访问：打印机，栈，变量等
     + 同时访问方式
       + 多个进程同时访问的资源：磁盘
   + 虚拟性
     + 通过某种技术把一个物理实体变为若干逻辑上的对应物
     + 虚拟处理机，虚拟内存
   + 异步性
     + 概念：进程以不可预知的速度向前推进

   


------



### 二、进程管理

#### 1.进程概念

+ 进程是进程实体的运行过程，是系统进行资源分配和调度的基本单位

+ 程序在并发环境中的执行过程
+ 特征
  + 结构特征
    + 进程控制块：PCB，相当于一个进程的头脑，动态特征的集中反映
    + 程序段：描述要完成的功能
    + 数据段：操作对象和工作区
  + 动态性
    + 进程有创建而产生，由调度而执行，由撤销而消亡
  + 并发性：多个进程同在内存中，且能在一段时间内同时运行
  + 独立性：进程时一个能独立运行，独立分配资源，独立接受调度的基本单位
  + 异步性：进程按各自独立的，不可预知的速度向前推进

#### 2.PCB

- PCB特征
  - PCB是OS中最重要的记录型结构
  - OS用PCB对并发进程进行管理和控制
  - PCB是进程存在的唯一标志
  - PCB常驻内存
  - OS专门开辟PCB区将所有的PCB组成若干个链表或队列
- PCB中的信息
  - 进程标识符
    - 内部标识符：进程唯一的数字编号，给OS使用
    - 外部标识符：由字母，数字组成，给用户使用
  - 处理机状态
    - 处理机中主要的寄存器
      - 通用寄存器：8-32，暂存信息用
      - 指令计数器：要访问的下一条指令的地址
      - 程序状态字PSW：条件码，执行方式，中断屏蔽标志
      - 用户栈指针：用户进程拥有的系统栈，存放过程和系统调用参数及调用地址
  - 进程调度信息
    - 进程状态
    - 进程优先级
      - 用一个整数来表示
      - 整数数值越大，优先级越高；优先级越高，就越可能占有处理机
    - 与调度算法有关信息
    - 事件，如阻塞原因
  - 进程控制信息
    - 程序和数据地址
    - 进程同步和通信机制
    - 资源清单：除CPU之外的所需资源与已经分配资源清单
    - 链接指针：本进程PCB所在队列的下一个地址
- PCB的组织方式
  - 链接方式
    - 将统一状态的进程划分为一组，创建一个指针指向这个组的第一个进程，根据PCB中存储的链接指针进行
  - 索引方式

#### 3.进程和程序

1. 程序顺序执行的特征
   - 顺序性：处理机的操作严格按照程序所规定的顺序执行
   - 封闭性：程序在封闭的环境下执行，结果不受外界因素的影响
   - 可再见性：只要环境和初始条件享用，程序重复执行时总得到相同结果
2. 并发程序执行的特征
   + 间断性：共享，合作，制约导致
   + 失去封闭性：资源状态由多程序改变
   + 不可再见性：相同和环境和初始条件重复执行结果不同
3. 进程和程序的关系
   + 进程是一个动态概念，程序是一个静态概念
   + 进程具有并行特征，程序没有
   + 进程是竞争资源的基本单位
   + 一个程序对应多个进程，一个进程为多个程序服务

#### 4.进程的状态

1. 进程的三种基本状态
   + 就绪状态
     + 进程已经分配了除处理机之外的所有必要资源，只要再获得处理机就能够执行的状态
     + 这样的进程可能有多个，通常排成一个队列
   + 执行状态
     + 已经获得CPU，正在运行
     + 在单CPU系统只有一个进程处于执行状态。多CPU系统则有多个处于执行状态
   + 阻塞状态
     + 正在执行的进程由于发生某事件而暂时无法继续执行，放弃处理机而进入的状态，又称等待状态
     + 引起阻塞的事件：请求I/O，申请缓存
2. 挂起状态
   + 引入原因
     + 终端用户请求
     + 父进程请求
     + 负荷调节需要
     + 操作系统需要

#### 5.进程的管理

+ 进程管理章最基本功能就是进程控制

+ 进程控制任务：

  + 进程的创建，终止，进程状态的转变等

+ 进程控制一般由OS内核实现

+ 引起创建进程的事件

  + 由系统内核创建
    + 用户登录
    + 作业调度
      + 将外存中的多个作业选择一个或多个调到内存中
    + 提供服务
  + 自己创建
    + 应用请求

+ 进程的创建

  + 申请空白PCB
  + 为新进程分配资源
  + 初始化进程控制块
  + 将新进程插入就绪队列
  + PCB的初始化
    + 初始化标识信息
    + 初始化处理机状态信息
    + 初始化处理机控制信息

+ 进程终止

  + 死因
    + 正常结束
    + 异常结束
      + 越界错误
      + 保护错：读写权限不够
      + 非法指令：
      + 特权指令错：
      + 运行超时：
      + 等待超时：
      + 算术运算错
      + I/O故障
    + 外界干预
      + 操作员或OS干预
      + 被父进程终止：父进程拥有比子进程更大的权力，父进程随时可以终止子进程
      + 父进程终止：父进程终止了，子进程也将随之终止
  + 过程
    + 从PCB集合中检索出该进程的PCB，从中读出该进程的状态
    + 若处于执行，终止该进程的执行，并置调度标志为真，重新调度
    + 若有子进程，将所有子孙进程终止
    + 将进程全部资源归还其父进程或系统
    + 将其PCB从所在队列（l链表）中移除

+ 进程状态转换

  + 引起阻塞和唤醒的事件
    + 请求系统服务
    + 启动某种操作
    + 新数据尚未到
    + 无新工作可做
  + 进程阻塞过程（BLOCK）
  + 进程唤醒过程（WakeUp）
    + 从等待队列中摘下给唤醒的进程
    + 置该进程的状态转为就绪态，并放入就绪队列
    + 转进程调度或返回
    + 注意：如果在某进程中调用了阻塞原语，则必须在与之相合作的另一个进程中或其他相关的进程中，安排唤醒原语，以便能唤醒阻塞进程；否则，被阻塞进程将会因不能被唤醒而长久处于阻塞状态，从而再无机会继续执行
  + 进程的挂起（Suspend）：内存  -----》外存
    + 检查被挂起进程的状态：
      + 若处于活动就绪状态，改为静止就绪；
      + 若处于活动阻塞状态，则改为静止阻塞；
      + 若正在执行，则转向调度程序重新调度

+ 进程的制约关系

  - 间接制约------互斥

    - 进程间由于共享某种资源，而形成的相互制约
    - 互斥：并发执行的多个进程由于竞争统一资源而产生的相互排斥的关系

  - 直接制约-------同步

    - 进程间由于合作而形成的相互制约
    - 同步：进程间共同完成一项任务时直接发生相互作用的关系
    - 同步进程间具有合作关系，在执行时间上必须按一定的顺序协调进行

  - 临界资源

    - 一次仅允许一个进程使用的共享资源：如打印机，磁带机，表格等

  - 临界区

    - 在每个进程中访问临界资源的那段程序
      - 进程必须互斥进入临界区
    - 访问临界区
      - 进去区：检查临界资源是否能访问
      - 临界区：
      - 推出区：将临界区标志设为未访问
      - 剩余区
    - 同步机制遵循的原则
      - 空闲让进
      - 忙则等待
      - 有限等待
      - 让权等待：正在执行的进程，如果判断不能使用临界资源，就必须放弃CPU资源

  - 信号量

    - 整信号量

      - Wait(s)

      ```c
      while S <= 0 do no-op
      	  S:=S-1;
      ```

      - Signal(s)

      ```c
      S:=S+1;
      ```

      - wait（s）和signa（s）是原子操作，执行过程中不允许插入任何其他操作
      - 只要信号量S<=0就不断测试，不满足让权等待，因为当判断发现自己不能使用临界资源的时候，因此自身的原子性，导致仍然占用CPU进行while判断，浪费CPU资源

    - 记录型信号量

      - 记录型结构，包含两个数据项

      ```
      type semaphore = record
      			value : integer;
      			L:list of process;	//进程的PCB链表
      			end
      ```

      - 结构

        - S.value为资源信号量其初值：某类资源的数目

          - S.value>=0时：代表系统当中可用资源的数目
          - S.value<0时：它的绝对值代表等待使用资源的进程个数
          - S.value初值为1时：只允许一个进程访问临界资源，是互斥信号量

        - wait操作：申请一个单位资源

          ```c
          Procedure wait(s)	//
          Var S:semaphore;
          begin
          	S.value:=S.value-1;
          	if S.value<0 then block(s,L)	//s指资源，进入阻塞队列
          end
          
          ```

        - signal操作：释放一个资源

          ```c
          Procedure signal(s)
          Var s:semaphore;
          begin
          	S.value:=S.value+1;
          	If S.value<=0 then wakeup(s,L)	//唤醒一个等待的进程，进入就绪队列
          end
          ```

    - AND型信号量

      - 基本思想：将进程在整个运行中需要的所有资源，一次性全部分配给进程，待进程使用完后一起释放

+ 进程通信

  + 概念：进程通信就是进程之间真的信息交换

  + 交换的信息量：

    + 一个状态或数字
    + 上千个字节

  + 分类

    + 低级通信：进程的互斥和同步
    + 高级通信：用户可直接利用操作系统提供的一组通信命令，
      + 高效地传输大量数据的通信方式
      + 对用户通明（用户不需要考虑系统的具体操作，仍可完成操作）。

  + 高级通信

    + 分类

      + 共享存储器系统
        + 共享数据结构：如缓冲池数据结构，这属于低级通信方式
        + 共享存储区：在存储区中划出一块共享存储区
      + 消息传递系统
        + 信息交换的单位是消息或报文
        + 直接通信方式
          + 发送进程直接把消息发送给目标进程
          + 发送进程和接收进程都以显式方式分别提供给对方标识符
          + 系统提供两条通信原语
            + Send（Receiver，message）
            + Receive（Send，message）
        + 间接通信方式
          + 进程之间的通信需要通过某种中间实体
          + 这种中间实体成为信箱
            + 私用信箱
              + 用户进程建立，作为该进程的一部分
              + 拥有者有权读消息，其他用户只能发送
              + 采用单向通信链路
              + 进程结束时信箱也消失
            + 公用信箱
              + 有OS创建
              + 提供给系统中的所有核准进程使用
              + 进程既发送也可取出
              + 采用双向通向链路的信箱来实现
            + 共享信箱
              + 由某个进程创建，创建时提供共享进程的名字
              + 信箱的拥有者和共享者，都有权从信箱中取走发送给自己的消息
          + 消息在信箱中可以安全地保存，只允许核准的目标用户随时读取，故可实现非实时通信
      + 管道通信
        + 建立在文件系统的基础上，利用共享文件来连接两个相互通信的进程，此共享文件称为管道（Pipe）
        + 管道时指用于连接一个读进程和写进程，以实现他们之间通信的共享文件
        + 文件存放在外存，节约内存资源
        + 管道通信必需的协调能力
          + 互斥
          + 同步

    + 2

      







+ 进程

  

  

  

  

  

  

  

  

  





### 

